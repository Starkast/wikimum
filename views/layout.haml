!!!
%html
  %head
    %meta{ 'http-equiv' => 'content-type', content: 'text/html; charset=utf-8' }
    %meta{ name: 'referrer', content: 'same-origin' }
    %title
      = "#{@page_title} - " if @page_title
      Starkast Wiki
    %link{ href: '/favicon.ico', rel: 'shortcut icon', type: 'image/ico' }
    %link{ href: "/stylesheets/default.css?#{App.cache_bust}", rel: 'stylesheet', type: 'text/css' }
    %script{ src: '/javascripts/mousetrap.min.js' }
    %script{ src: '/javascripts/mousetrap-global-bind.min.js' }
    - settings.js.each do |js|
      %script{ src: js.fetch(:url), integrity: js.fetch(:sha), crossorigin: :anonymous }
  %body
    %div{ id: @edit_mode ? 'container-lg' : 'container' }
      #header
        #login
          != haml :'../layouts/_login', layout: false
        #administration
          != haml :'../layouts/_administration', layout: false
      #logo
        != haml :'../layouts/_logo', layout: false
      #navigation
        != haml :'../layouts/_navigation', layout: false
      #sub-navigation
        #actions
          -if @page
            != haml :'../page/_actions', locals: { page: @page }, layout: false
        #status
      != haml :'../layouts/_flash', layout: false
      #content
        !=yield
    #footer
      != haml :'../layouts/_footer', layout: false

    #keyboard-help
      .modal
        %h2 Keyboard Shortcuts
        %dl
          .section-label Navigation
          %dt
            %kbd ?
          %dd Show this help
          %dt
            %kbd /
            or
            %kbd s
          %dd Focus search
          %dt
            %kbd h
          %dd Go to home
          %dt
            %kbd i
          %dd Go to index
          %dt
            %kbd l
          %dd Go to latest
          %dt
            %kbd n
          %dd New page
          %dt
            %kbd Esc
          %dd Close
          .section-label Page view
          %dt
            %kbd e
          %dd Edit page

    :javascript
      Mousetrap.bind(['?'], function() {
        var help = document.getElementById('keyboard-help');
        help.classList.toggle('visible');
        return false;
      });

      Mousetrap.bind(['/', 's'], function() {
        var searchInput = document.getElementById('q');
        searchInput.focus();
        searchInput.select();
        return false;
      });

      Mousetrap.bind('h', function() {
        window.location = "/";
        return false;
      });

      Mousetrap.bind('i', function() {
        window.location = "/list";
        return false;
      });

      Mousetrap.bind('l', function() {
        window.location = "/latest";
        return false;
      });

      Mousetrap.bind('n', function() {
        window.location = "/new";
        return false;
      });

      Mousetrap.bindGlobal('escape', function() {
        var help = document.getElementById('keyboard-help');
        if (help.classList.contains('visible')) {
          help.classList.remove('visible');
          return false;
        }
        var searchInput = document.getElementById('q');
        if (document.activeElement == searchInput) {
          searchInput.blur();
        }
        return false;
      });

      document.getElementById('keyboard-help').addEventListener('click', function(e) {
        if (e.target === this) {
          this.classList.remove('visible');
        }
      });
